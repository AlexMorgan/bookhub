<h1>Dashboard</h1>

<%= image_tag @user.avatar.url(:medium) %>
<h2><%= @user.fullname %></h2><cite><%= link_to "Edit Profile", edit_user_registration_path %></cite>
<div class="row">
  <div class="col-md-6">
    <h3>Books Added</h3>
    <p><%= "You have #{@user.books.where(sold: "false").count} book(s) for sale" %></p>
    <ul>
      <% @user.books.order(title: :asc).each do |book| %>
      <% if book.sold == false %>
      <li><%= link_to book.title, book_path(book) %>
        - <%= link_to "Edit", edit_book_path(book.id) %> | <%= link_to "Delete", book, method: :delete, data: {confirm: "Are you sure you want to delete this book from your library?"} %></li>
      <% end %>
      <% end %>
    </ul>
    <%= link_to "Add Book", new_book_path %>
  </div>

  <div class="col-md-6">
    <h3>My Offers</h3>
    <ul>
      <% @user.books.each do |book| %>
        <% book.offers.order(created_at: :desc).each do |offer| %>
        <li>
          <%= book.title %> <%= link_to "Accept!", book_path(book), class: "btn-sm btn-success" %><br>
          Offer: $<%= offer.amount %><br>
          Bidder: <%= offer.user.fullname %>
        </li>
        <% end %>
      <% end %>
    </ul>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <h3>Books Sold</h3>
    <p><%= "You have sold #{@user.books.where(sold: "true").count} book(s)" %></p>
    <ul>
      <% @user.books.each do |book| %>
        <% if book.sold == true %>
          <li><%= book.title %></li>
        <% end %>
      <% end %>
    </ul>
  </div>

  <div class="col-md-6">
    <h3>My Bids</h3>
    <p><%= "You have #{@user.offers.where(accepted: "false").count} pending offer(s)" %></p>
    <ul>
      <% @user.offers.each do |offer| %>
      <li>
        <%= offer.book.title %> <%= link_to "Revoke", offer, method: :delete, class: "btn-sm btn-danger", data: {confirm: "Are you sure you want to remove this offer?"} %><br>
        Offer: $<%= offer.amount %><br>
        Seller: <%= offer.book.user.fullname %>
      </li>
    <% end %>
    </ul>
  </div>
</div>

<%= link_to "Back", :back %>
